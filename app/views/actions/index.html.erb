<% content_for :pageTitle do %>
    <%= t('layout.title.action.list') %>
<% end %>

<section id="action-list-header" class="showOverflow">

  <div class="select-year">
    <h1>Alle Aktionen</h1>
  </div>

  <div style="text-align: right">
    <div class="infobox">
      <span><%= Action.visible.count %></span>
      <div><%= Action.model_name.human(count: Action.visible.count) %></div>
    </div>
    <div class="infobox">
      <span><%= User.joins('LEFT JOIN "participations" ON "participations"."user_id" = "users"."id"')
                      .joins('LEFT JOIN "leaderships" ON "leaderships"."user_id" = "users"."id"')
                      .joins('INNER JOIN "actions" ON "actions"."id" = "leaderships"."action_id" OR "actions"."id" = "participations"."action_id"')
                      .where('actions.visible': true).distinct.count %></span>
      <div><%= t('user.label.countActive') %></div>
    </div>
  </div>

  <div class="clearfix"></div>
</section>

<div class="row">

  <div class="col-md-3 col-md-push-9">
    <div class="row row-sm-eq-height row-md-diff-height">

      <section class="col-sm-6 col-md-12 slim">
          <h3>Filtern</h3>
          <%= bootstrap_form_for(:filter, url: actions_path, method:'get', html:{id:'actionFilter'}) do |f| %>
              <%#= collection_select(:week, ActionGroup.all, :id, :title,
                 :include_blank => "- - - Aktionswoche egal - - -") %>
              <%= f.select(:day, options_for_day_select(ActionGroup.all), include_blank: "- - - Alle Tage - - -", hide_label: true) %>
              <%= f.select(:status,
                           Action.statuses.keys.map { |s| [t("action.status.#{s}"), s] },
                           include_blank: "- - - Status egal - - -", hide_label: true) %>
              <% if user_signed_in? && current_user.in_orga_team? %>
                  <%= f.select(:visibility,
                     [['Sichtbar', :visible], ['Versteckt', :hidden]],
                     hide_label: true) %>
              <% end %>
              <%= f.submit 'Aktionen filtern', class:'btn btn-default btn-wide' %>
              <div id="filterResults"></div>
          <% end %>
      </section>

      <section class="col-sm-6 col-md-12 slim hidden-xs hidden-sm">
          <h3>Optionen</h3>
          <%= link_to t('action.action.new'),
                      new_action_path, class:'btn btn-default btn-wide' %>
      </section>

    </div>
  </div>

  <div class="col-md-9 col-md-pull-3" id="action-list">
    <% @actions.each do |action| %>
        <section class="action">
          <div class="action-title">
            <%= link_to action do %>
               <h2><%= action.title %></h2>
            <% end %>
          </div>
          <div class="action-image">
            <%= link_to action do %>
                <% if action.show_picture? && action.picture.file %>
                    <%= image_tag action.picture_url(:action_list), lazy:true %>
                <% else %>
                    <%= image_tag 'placeholder.svg' %>
                <% end %>
                <div class="action-status status_<%= action.status %>">
                  <%= t "action.status.#{action.status}" %>
                </div>
            <% end %>
          </div>
          <div class="action-description">
            <% if action.short_description.empty? %>
                <div><%= action.description %></div>
            <% else %>
                <div><%= action.short_description %></div>
            <% end %>
          </div>
        </section>
    <% end %>
  </div>

</div>

<section class="visible-xs visible-sm slim">
  <h3>Optionen</h3>
  <%= link_to t('action.action.new'),
              new_action_path, class:'btn btn-default btn-wide' %>
</section>