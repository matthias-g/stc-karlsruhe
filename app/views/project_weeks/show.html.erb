<% content_for :pageTitle do %>
  <%= t('layout.title.projectList', year: @project_week.title) %>
<% end %>

<% content_for :appendToHeader do %>
  <meta name="description" content="Alle Projekte der Projektwoche <%= @project_week.title %> findest du hier.
  Welches Projekt passt zu dir?" />

  <meta property="og:title" content="<%= t('layout.title.projectList', year: @project_week.title) %>" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https//www.servethecity-karlsruhe.de/images/logo.png" />
  <meta property="og:url" content="<%= show_project_week_url(@project_week.title) %>" />
  <meta property="og:description" content="Alle Projekte der Projektwoche <%= @project_week.title %> findest du hier.
  Welches Projekt passt zu dir?" />
  <meta property="og:locale" content="de_DE" />
  <meta property="og:site_name" content="Serve the City Karlsruhe" />
<% end %>

<section id="project-list-header" class="showOverflow">

  <div class="select-year">
    <h1>Projektwoche <%= @project_week.title %></h1>
    <%= render partial: 'layouts/week_dropdown', locals: { target_path: method(:show_project_week_path) } %>
  </div>

  <div style="text-align: right">
    <div class="infobox">
      <span><%= @project_week.projects.visible.where.not(desired_team_size: 0).count %></span>
      <div><%= Project.model_name.human(count: @project_week.projects.visible.count) %></div>
    </div>
    <% if @project_week.active_user_count > 0 %>
      <div class="infobox">
        <span><%= @project_week.active_user_count %></span>
        <div><%= t('user.label.countActive') %></div>
      </div>
    <% end %>
    <% if @project_week.vacancy_count > 0 %>
      <div class="infobox">
        <span><%= @project_week.vacancy_count %></span>
        <div><%= t('project.label.vacancies') %></div>
      </div>
    <% end %>
  </div>

  <div class="clearfix"></div>
</section>

<div class="row">

  <div class="col-md-3 col-md-push-9">
    <div class="row row-sm-eq-height row-md-diff-height">

      <section class="col-sm-6 col-md-12 slim">
        <h3>Filtern</h3>
        <%= bootstrap_form_for(:filter, url: projects_path, method:'get', html:{id:'projectFilter'}) do |f| %>
          <%#= collection_select(:week, ProjectWeek.all, :id, :title,
                 :include_blank => "- - - Aktionswoche egal - - -") %>
          <%= f.collection_select(:day, @project_week.days.order(date: :asc), :id, :title,
                                  include_blank: "- - - Alle Tage - - -", hide_label: true) %>
          <%= f.select(:status,
                       Project.statuses.keys.map { |s| [t("project.status.#{s}"), s] },
                       include_blank: "- - - Status egal - - -", hide_label: true) %>
          <% if user_signed_in? && current_user.admin? %>
            <%= f.select(:visibility, [['Sichtbar', :visible], ['Versteckt', :hidden]],
                         include_blank: "- - - Sichtbarkeit egal - - -", hide_label: true) %>
          <% end %>
          <%= f.submit 'Projekte filtern', class:'btn btn-default btn-wide' %>
          <div id="filterResults"></div>
        <% end %>
      </section>

      <section class="col-sm-6 col-md-12 slim hidden-xs hidden-sm">
        <h3>Eigenes Projekt</h3>
        <span>Du möchtest ein eigenes Projekt starten?</span>
        <%= link_to t('project.message.startOwnInfo'),
                    '/eigenes-projekt', class:'btn btn-default btn-new-project' %>
      </section>

      <% if policy(:project).new? %>
        <section class="col-sm-6 col-md-12 slim hidden-xs hidden-sm">
          <h3>Optionen</h3>
          <%= link_to t('project.action.new'),
                      new_project_path, class:'btn btn-default btn-wide' %>
        </section>
      <% end %>

    </div>
  </div>

  <div class="col-md-9 col-md-pull-3" id="project-list">
    <% @projects.each do |project| %>
      <% visible_subprojects = policy_scope(project.subprojects) %>
      <section class="project">
        <div class="project-title">
          <%= link_to project do %>
            <h2><%= project.title %></h2>
            <% if visible_subprojects.count > 0 %>
              <h3><%= t('project.label.subprojects', count: visible_subprojects.count) %></h3>
            <% end %>
          <% end %>
        </div>
        <div class="project-image">
          <%= link_to project do %>
            <% if project.show_picture? && project.picture.file %>
              <%= image_tag project.picture_url(:project_list), lazy:true %>
            <% else %>
              <%= image_tag 'placeholder.svg' %>
            <% end %>
            <% ext_status = project.visible? ? project.status : :hidden %>
            <div class="project-status status_<%= ext_status %>">
              <%= t "project.status.#{ext_status}" %>
            </div>
          <% end %>
        </div>
        <div class="project-description">
          <% if project.short_description.empty? %>
              <div><%= project.description %></div>
          <% else %>
              <div><%= project.short_description %></div>
          <% end %>
        </div>
      </section>
    <% end %>
    <% if @project_week.projects.toplevel.visible.count == 0 %>
      <section>
        <%= t('project_week.noProjects') %>
      </section>
    <% end %>
  </div>

</div>

<section class="visible-xs visible-sm slim">
  <h3>Eigenes Projekt</h3>
  <span>Du möchtest ein eigenes Projekt starten?</span>
  <%= link_to t('project.message.startOwnInfo'),
              '/eigenes-projekt', class:'btn btn-default btn-new-project' %>
</section>

<% if policy(:project).new? %>
    <section class="visible-xs visible-sm slim">
      <h3>Optionen</h3>
      <%= link_to t('project.action.new'),
                  new_project_path, class:'btn btn-default btn-wide' %>
    </section>
<% end %>