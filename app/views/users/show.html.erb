<% content_for :pageTitle do %>
    <%= t('layout.title.userView', user:@user.full_name) %>
<% end %>

<div id="user-view">

<section>
  <div class="typeHeader">
    <%= (@user == current_user) ? t('user.label.myProfile') : t('user.label.profile') %>
  </div>
  <h1><%= @user.full_name %></h1>
</section>

<div class="row row-sm-eq-height">
  <div class="col-sm-6">

    <% if (current_user == @user) || current_user.is_admin? %>
      <section class="profile-data">
        <h2><%= t('user.label.userData') %></h2>
        <table>
          <tr>
            <td><%= t('activerecord.attributes.user.username') %>:</td>
            <td><%= @user.username %></td>
          </tr>
          <tr>
            <td><%= t('activerecord.attributes.user.email') %>:</td>
            <td><%= @user.email %></td>
          </tr>
          <tr>
            <td><%= t('activerecord.attributes.user.phone') %>:</td>
            <td><%= @user.phone %></td>
          </tr>
        </table>
        <% if (@user == current_user) || current_user.is_admin?  %>
            <%= link_to edit_user_path, title: t('user.action.edit'),
                   class:'btn btn-default' do %>
                <span class="glyphicon glyphicon-pencil"></span>
                <%= t('user.action.edit') %>
            <% end %>
        <% end %>
      </section>
    <% end %>

    <% unless @user == current_user  %>
      <section class="contact-user-form">
        <h2><%= t('contact.user.title', recipient: @user.first_name) %></h2>
        <%= bootstrap_form_for @message, url: { action: 'contact_user' } do |f| %>
          <%= f.text_field :subject %>
          <%= f.text_area :body %>
          <%= f.submit t('contact.user.submit') %>
        <% end %>
      </section>
    <% end %>

    <% if @user == current_user  %>
      <section class="actions">
        <h2>Aufgaben</h2>
        <%= link_to t('contact.orga.link'), kontakt_path,
                 class:'btn btn-default btn-wide' %>
        <%= link_to t('project.action.searchProjects'), projects_path,
                 class:'btn btn-default btn-wide' %>
        <%= link_to t('project.action.new'), new_project_path,
                 class:'btn btn-default btn-wide' %>
      </section>
    <% end %>
  </div>

  <section class="col-sm-6 projects">
      <h2><%= Project.model_name.human(count:2) %></h2>
      <%
         @pastProjects = (@user.projects_as_volunteer | @user.projects_as_leader)
            .select{|p| p.status == 'closed'}
         @projectsAsLeader = @user.projects_as_leader - @pastProjects
         @projectsAsVolunteer = @user.projects_as_volunteer - @projectsAsLeader - @pastProjects
      %>
      <% if @projectsAsLeader.any? %>
        <h3><%= t('user.label.projectsAsLeader') %> (<%= @projectsAsLeader.size %>
           <%= Project.model_name.human(count: @projectsAsLeader.size) %>):</h3>
        <% @projectsAsLeader.each do |project| %>
            <%= link_to project.title, project %>
        <% end %>
      <% end %>
      <% if @projectsAsVolunteer.any? %>
        <h3><%= t('user.label.projectsAsVolunteer') %> (<%= @projectsAsVolunteer.size %>
           <%= Project.model_name.human(count: @projectsAsVolunteer.size) %>):</h3>
        <% @projectsAsVolunteer.each do |project| %>
            <%= link_to project.title, project %>
        <% end %>
      <% end %>
      <% if @pastProjects.any? %>
          <h3><%= t('user.label.pastProjects') %> (<%= @pastProjects.size %>
            <%= Project.model_name.human(count: @pastProjects.size) %>):</h3>
          <% @pastProjects.each do |project| %>
              <%= link_to project.title, project %>
          <% end %>
      <% end %>
      <% if @user.projects_as_volunteer.blank? && @user.projects_as_leader.blank? %>
        <% if current_user == @user %>
          <%= t('user.message.youHaveNoProjects') %><br />
          <%= link_to t('project.action.findProject'), projects_path %>
        <% else %>
          <%= t('user.message.hasNoProjects', user:@user.first_name) %>
        <% end %>
      <% end %>
  </section>
</div>

</div>



